<!DOCTYPE html>
<html>
<canvas id="c"></canvas>
<script>
var canvas = document.getElementById("c");
canvas.width = window.innerWidth, canvas.height = window.innerHeight;
canvas.style.display = "block", canvas.style.width = "100vw", canvas.style.height = "100vh";
document.body.style.margin = "0";
var ctx = canvas.getContext("2d");
var x=50, y=50, speed=2;
var root2 = Math.sqrt(2);
var left, up, right, down;
var difficulty = "e";
var shots = [];
var servers = [];
var packets = [];
var corrupt = true, kill = false, destruction = false;
var gun = "c";//c = corrupt gun, k = kill gun, d = destruction gun
var server = new Image();
server.src = "server.svg";
function draw() {
	var scale = 5;
	ctx.beginPath();
	ctx.moveTo(x+scale*(1), y+scale*(1+root2));
	ctx.lineTo(x+scale*(1), y-scale*(1+root2));
	ctx.lineTo(x+scale*(1+root2), y-scale*(1));
	ctx.lineTo(x-scale*(1+root2), y-scale*(1));
	ctx.lineTo(x-scale*(1), y-scale*(1+root2));
	ctx.lineTo(x-scale*(1), y+scale*(1+root2));
	ctx.lineTo(x-scale*(1+root2), y+scale*(1));
	ctx.lineTo(x+scale*(1+root2), y+scale*(1));
	ctx.closePath();
	ctx.stroke();
}

function clear() {
	ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function move() {
	if (up) {y -= speed;};
	if (left) {x -= speed;};
	if (right) {x += speed;};
	if (down) {y += speed;};
}

function animate() {
	clear();
	move();
	draw();
	for (var i=0;i<shots.length;i++) {
		shots[i].move();
		shots[i].draw();
	}
	for (var i=0;i<servers.length;i++) {
		servers[i].draw();
	}
	for (var i=0;i<packets.length;i++) {
		packets[i].draw();
	}
	requestAnimationFrame(animate);
}
animate();
document.addEventListener("keydown", function(e) {
	switch (e.key) {
		case "w": case "ArrowUp":
			up = true;
		break;
		case "a": case "ArrowLeft":
			left = true;
		break;
		case "d": case "ArrowRight":
			right = true;
		break;
		case "s": case "ArrowDown":
			down = true;
		break;
		case "1":
			if (corrupt) {gun = "c"};
		break;
		case "2":
			if (kill) {gun = "k"};
		break;
		case "3":
			if (destruction) {gun = "d"};
		break;
	}
});
document.addEventListener("keyup", function(e) {
	switch (e.key) {
		case "w": case "ArrowUp":
			up = false;
		break;
		case "a": case "ArrowLeft":
			left = false;
		break;
		case "d": case "ArrowRight":
			right = false;
		break;
		case "s": case "ArrowDown":
			down = false;
		break;
	}
});
canvas.addEventListener("mousedown", function(e) {
	var theta = Math.atan2(e.offsetY - y, e.offsetX - x);
	var newX = Math.cos(theta);
	var newY = Math.sin(theta);
	new Shot(x, y, newX, newY);
});

function Shot(x, y, dirX, dirY) {
	this.x = x;
	this.y = y;
	this.radius = 5;
	this.dirX = dirX;//use two variables so you don't have to do trig maths :)
	this.dirY = dirY;
	this.type = gun;
	this.speed = 4;
	shots.push(this);
	this.move = function() {
		this.x += this.dirX * this.speed;
		this.y += this.dirY * this.speed;
	};
	this.draw = function() {
		ctx.beginPath();
		ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
		ctx.stroke();
		ctx.closePath();
		//draw separate icon
	};
	this.checkCollisions = function() {
		for (var i=0;i<packets.length;i++) {
			if (circleRectCollision(this, packets[i])) {
				
			}
		}
		for (var i=0;i<servers.length;i++) {
			if (circleRectCollision(this, servers[i])) {
				
			}
		}
	};
}

//found in old code somewhere, not mine
function circleRectCollision(c, r) {
	var distX = Math.abs(c.x - r.x-r.width/2);
	var distY = Math.abs(c.y - r.y-r.height/2);

	if (distX > (r.width/2 + c.radius)) { return false; }
	if (distY > (r.height/2 + c.radius)) { return false; }

	if (distX <= (r.width/2)) { return true; } 
	if (distY <= (r.height/2)) { return true; }

	var dx=distX-r.width/2;
	var dy=distY-r.height/2;
	return (dx*dx+dy*dy<=(c.radius*c.radius));
}

function Server(x, y) {
	this.x = x;
	this.y = y;
	this.width = 50;
	this.height = 80;
	servers.push(this);
	this.draw = function() {
		ctx.drawImage(server, this.x, this.y, this.width, this.height);
	};
}

function Packet(x, y, dirX, dirY) {
	this.x = x;
	this.y = y;
	this.width = 90;
	this.height = 25;
	this.data;//use even parity
	packets.push(this);
	this.getRandomData = function() {
		this.data = Math.floor(Math.random()*256).toString(2);
		while (this.data.length < 8) {
			this.data = "0" + this.data;
		}
	};
	this.getRandomData();
	this.draw = function() {
		ctx.beginPath();
		ctx.rect(this.x, this.y, this.width, this.height);
		ctx.stroke();
		ctx.font = "16px Verdana";
		ctx.fillText(this.data, this.x+5, this.y+17);
	};
}

</script>
</html>